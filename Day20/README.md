# DAY 18

## Topics Covered

- Connecting SQL Server Database with .NET Application
- Database First Method
- Code First Method

The work done on these topics can be found in the following repositories

- [Database First Method](./SampleEFApplicationSolution)
- [Code First Method](./EFCoreCodeFirstAppSolution)

## Work

**Questions**
- Take your app built on Day7 Question. Convert the repository layer to EF Core. 

This work done can be found in this [repository](https://github.com/RajKousik/GenSparkTraining/tree/master/Day7/RequestTrackerSolution)

# Entity Framework Core 

Entity Framework Core and how to use it to interact with a SQL database in a .NET application. We scaffolded a SQL database into a request tracker application.

## Scaffolding the Database

the Scaffold-DbContext command to generate the context and entity classes for the dbEmployeeTracker database.

```bash
Scaffold-DbContext "Data Source=823CBX3\DEMOINSTANCE;Integrated Security=true;Initial Catalog=RequestTrackerApp" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Model
```

## Database for Employee


```sql
CREATE DATABASE RequestTrackerApp;
GO

use RequestTracker;

  CREATE TABLE Employees(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(30),
	Age INT,
	DOB DATETIME,
	Salary FLOAT,
	Role VARCHAR(30),
)

CREATE TABLE Departments(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(30),
	DepartmentHead INT,
)

CREATE TABLE Requests(
	Id INT PRIMARY KEY,
	RequestTest VARCHAR(50),
	RaisedBy INT,
	Status VARCHAR(50),
	ClosedBy INT,
	RaisedDate DATETIME,
	ClosedDate DATETIME
)


ALTER TABLE Employees
ADD EmployeeDepartment INT FOREIGN KEY REFERENCES Departments(Id);
```

## Overview of Department Repository after the changes

```c#
public class DepartmentRepository : IRepository<int, Department>
{
    RequestTrackerAppContext context = new RequestTrackerAppContext();
    private List<Department> _departments;

    public DepartmentRepository()
    {
        _departments = context.Departments.ToList();
    }


    int GenerateId()
    {
        if(_departments.Count == 0)
        {
            return 1;
        }
        int id = _departments.Count;
        return ++id;
    }

    public Department Add(Department item)
    {
        //item.Id = GenerateId(); //no more need of generating id, as id will be 
        //                          generated by the database automatically
        context.Departments.Add(item);
        context.SaveChanges();
        _departments = context.Departments.ToList();
        if (_departments.Contains(item)) 
            return item;
        return null;
    }

    public Department Delete(int key)
    {
        var department = _departments.SingleOrDefault(d => d.Id == key);
        if (department != null)
        {
            context.Departments.Remove(department);
            context.SaveChanges();
            _departments = context.Departments.ToList();
            return department;
        }
        return null;
    }

    public List<Department> GetAll()
    {
        var list = context.Departments.ToList();
        if (list.Count == 0)
            return null;

        return list;
    }

    public Department Get(int key)
    {
        var department = _departments.SingleOrDefault(d => d.Id == key);
        if (department != null)
        {
            return department;
        }
        return null;
    }

    public Department Update(Department item)
    {
        var department = _departments.SingleOrDefault(d => d.Id == item.Id);
        if (department != null)
        {
            department = item;
            context.Departments.Update(department);
            context.SaveChanges();
            return department;
        }
        return null;
    }
}

```

## Output Screenshots

![image](https://github.com/RajKousik/GenSparkTraining/assets/91744323/28528c4c-f3e8-42ed-bce3-a9595cb3403e)

![image](https://github.com/RajKousik/GenSparkTraining/assets/91744323/62f2ae46-0945-48b6-8dbd-efdf09f7dfe9)

![image](https://github.com/RajKousik/GenSparkTraining/assets/91744323/93984c62-94bb-486f-8c99-f409b2d313b3)

![image](https://github.com/RajKousik/GenSparkTraining/assets/91744323/91cc0b59-3127-4b2b-b95a-a47935f4b5a5)


All modifications made to the Department entity are also implemented to the Employee entity.

You can find the work directory [here](https://github.com/RajKousik/GenSparkTraining/tree/master/Day7/RequestTrackerSolution)

